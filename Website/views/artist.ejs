
<html>
  <head>
        <script type='text/javascript' src="//code.jquery.com/jquery-1.10.1.min.js"></script>
        <script type='text/javascript' src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0-alpha.1/handlebars.min.js"></script>
        <script type='text/javascript' src="//developer.spotify.com/web-api/static/css/cached.css"></script>
    <link href='https://fonts.googleapis.com/css?family=Megrim' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css"> <!-- load bootstrap css -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css"> <!-- load fontawesome -->
    
    <title>Welcome to EarBuds!</title>

    <style>
            h1 {
                color:#006666;
                font-family: 'Megrim', sans-serif;
                font-weight: bolder;
                font-size: 200%;
                
            }
    </style>

<<<<<<< HEAD
  <div class="container">
    <h1>Search for another Artist</h1>
    <form id="search-form">
      <input type="text" id="query" value="" class="form-control" placeholder="Type an Artist Name" />
      <input type="submit" id="search" class="btn btn-warning btn-lgt" value="Search" />
    </form>
    <div id="results"></div>
      <div class="home">
      <p>Or go <a href="/">home</a>.</p>
  </div>
  </div>
=======
    <div class="container">
      <h1>Search for another Artist</h1>
      <form id="search-form">
        <input type="text" id="query" class="form-control" placeholder="Type an Artist Name" value="<%=typeahead%>"/>
        <input type="submit" id="search" class="btn btn-primary" value="Search" />
      </form>
      <div id="results"></div>
    </div>
  </head>
    
<body>
>>>>>>> de975d1a6b54c58fa09dd536bc67a95c98d95872
  <script id="results-template" type="text/x-handlebars-template">
    {{#each albums.items}}
    <div style="background-image:url({{images.0.url}})" data-album-id="{{id}}" class="cover"></div>
    {{/each}}
  </script>
  
    <div class="wrapper">
        <script>
            var SpotifyWebApi = require('spotify-web-api-node');

            var spotifyApi = new SpotifyWebApi();
              
            document.getElementById('search-form').addEventListener('submit', function(e) {
                e.preventDefault();
                spotifyApi.getArtist(document.getElementById('query').value)
                    .then(function(data) {
                    console.log('Artist information', data.body);
                    }, function(err) {
                    console.error(err);
                    });
            }, false); 
        </script>
    </div>

  <style> 
    body {
      padding: 20px;
    }
    
    #search-form,
    .form-control {
      margin-bottom: 20px;
    }
    
    .cover {
      width: 300px;
      height: 300px;
      display: inline-block;
      background-size: cover;
    }
    
    .cover:hover {
      cursor: pointer;
    }
    
    .cover.playing {
      border: 5px solid #e45343;
    }
  </style>
</body>


<script>
  // Prefill the form and submit on page load
  window.onload = function preFill() {
    searchAlbums('<%=typeahead%>');
    spotifyApi.getArtist('<%=typeahead%>')
      .then(function(data) {
      console.log('Artist information', data.body);
      }, function(err) {
      console.error(err);
    });
  };
  
  // find template and compile it
  var templateSource = document.getElementById('results-template').innerHTML,
    template = Handlebars.compile(templateSource),
    resultsPlaceholder = document.getElementById('results'),
    playingCssClass = 'playing',
    audioObject = null;
  
  var fetchTracks = function(albumId, callback) {
    $.ajax({
      url: 'https://api.spotify.com/v1/albums/' + albumId,
      success: function(response) {
        callback(response);
      }
    });
  };
  
  var searchAlbums = function(query) {
    $.ajax({
      url: 'https://api.spotify.com/v1/search',
      data: {
        q: query,
        type: 'album'
      },
      success: function(response) {
        resultsPlaceholder.innerHTML = template(response);
      }
    });
  };
  
  results.addEventListener('click', function(e) {
    var target = e.target;
    if (target !== null && target.classList.contains('cover')) {
      if (target.classList.contains(playingCssClass)) {
        audioObject.pause();
      } else {
        if (audioObject) {
          audioObject.pause();
        }
        fetchTracks(target.getAttribute('data-album-id'), function(data) {
          audioObject = new Audio(data.tracks.items[0].preview_url);
          audioObject.play();
          target.classList.add(playingCssClass);
          audioObject.addEventListener('ended', function() {
            target.classList.remove(playingCssClass);
          });
          audioObject.addEventListener('pause', function() {
            target.classList.remove(playingCssClass);
          });
        });
      }
    }
  });
  
  document.getElementById('search-form').addEventListener('submit', function(e) {
    e.preventDefault();
    searchAlbums(document.getElementById('query').value);
  }, false);
</script>
